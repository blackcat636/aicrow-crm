# üìã –ü–æ–≤–Ω–∏–π –æ–ø–∏—Å –º–æ–¥—É–ª—å–Ω–æ—ó –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏ Uncar Admin

## üéØ –ú–µ—Ç–∞

–°—Ç–≤–æ—Ä–∏—Ç–∏ –¥–∏–Ω–∞–º—ñ—á–Ω—É –º–æ–¥—É–ª—å–Ω—É —Å–∏—Å—Ç–µ–º—É, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î:

- –í–º–∏–∫–∞—Ç–∏/–≤–∏–º–∏–∫–∞—Ç–∏ –º–æ–¥—É–ª—ñ —á–µ—Ä–µ–∑ API –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É
- –ö–µ—Ä—É–≤–∞—Ç–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –Ω–∞ —Ä—ñ–≤–Ω—ñ –º–æ–¥—É–ª—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –±—É–¥—É–≤–∞—Ç–∏ –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∞–∫—Ç–∏–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤
- –ó–∞—Ö–∏—â–∞—Ç–∏ –º–∞—Ä—à—Ä—É—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–æ–¥—É–ª—å–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤

## üìÅ –°—Ç–≤–æ—Ä–µ–Ω—ñ —Ñ–∞–π–ª–∏ —Ç–∞ —ó—Ö –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è

### 1. **API Endpoint** - `app/api/modules/active/route.ts`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ü–æ–≤–µ—Ä—Ç–∞—î —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤ –∑ –º–µ—Ç–∞–¥–∞–Ω–∏–º–∏

```typescript
// –ü–æ–≤–µ—Ä—Ç–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É:
{
  status: 200,
  data: [
    {
      key: 'cars',
      name: 'Cars',
      routes: ['/cars', '/brands', '/models'],
      icon: 'IconListDetails',
      menu: true,
      order: 2,
      permissions: {
        can_view: true,
        can_edit: true,
        can_delete: true
      },
      subItems: [...]
    }
  ]
}
```

**–õ–æ–≥—ñ–∫–∞**:

- –ú—ñ—Å—Ç–∏—Ç—å mock –¥–∞–Ω—ñ –¥–ª—è –≤—Å—ñ—Ö –º–æ–¥—É–ª—ñ–≤
- –í —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—ñ –±—É–¥–µ –∑–∞–ø–∏—Ç—É–≤–∞—Ç–∏ NestJS backend
- –§—ñ–ª—å—Ç—Ä—É—î –º–æ–¥—É–ª—ñ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤
- –ü–æ–≤–µ—Ä—Ç–∞—î —Ç—ñ–ª—å–∫–∏ –∞–∫—Ç–∏–≤–Ω—ñ –º–æ–¥—É–ª—ñ –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º–∏ –¥–æ–∑–≤–æ–ª–∞–º–∏

### 2. **TypeScript —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏** - `interface/Module.ts`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –¢–∏–ø—ñ–∑–∞—Ü—ñ—è –¥–ª—è –º–æ–¥—É–ª—ñ–≤ —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤

```typescript
export interface Module {
  key: string; // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –º–æ–¥—É–ª—è
  name: string; // –ù–∞–∑–≤–∞ –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
  routes: string[]; // –ú–∞—Ä—à—Ä—É—Ç–∏, —è–∫—ñ –æ–±—Å–ª—É–≥–æ–≤—É—î –º–æ–¥—É–ª—å
  icon: string; // –ù–∞–∑–≤–∞ —ñ–∫–æ–Ω–∫–∏
  menu: boolean; // –ß–∏ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤ –º–µ–Ω—é
  order: number; // –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  permissions: ModulePermission; // –î–æ–∑–≤–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  subItems?: ModuleSubItem[]; // –ü—ñ–¥–ø—É–Ω–∫—Ç–∏ –º–µ–Ω—é
}
```

**–õ–æ–≥—ñ–∫–∞**:

- –ó–∞–±–µ–∑–ø–µ—á—É—î —Ç–∏–ø–æ–±–µ–∑–ø–µ–∫—É –¥–ª—è –≤—Å—ñ—Ö –º–æ–¥—É–ª—å–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π
- –í–∏–∑–Ω–∞—á–∞—î —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–æ–∑–≤–æ–ª—ñ–≤ (can_view, can_edit, can_delete)
- –û–ø–∏—Å—É—î —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API

### 3. **Zustand Store** - `store/useModulesStore.ts`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Å—Ç–∞–Ω–æ–º –º–æ–¥—É–ª—ñ–≤

```typescript
export const useModulesStore = create<ModuleStore>((set, get) => ({
  modules: [], // –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤
  isLoading: false, // –°—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
  error: string | null, // –ü–æ–º–∏–ª–∫–∏
  lastFetched: number | null, // –ß–∞—Å –æ—Å—Ç–∞–Ω–Ω—å–æ–≥–æ –∑–∞–ø–∏—Ç—É

  fetchModules: async () => {
    // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤
    // –ö–µ—à—É–≤–∞–Ω–Ω—è –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
    // –ó–∞–ø–∏—Ç –¥–æ /api/modules/active
    // –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Å—Ç–∞–Ω—É
  },

  getModuleByKey: (key) => {
    // –ü–æ—à—É–∫ –º–æ–¥—É–ª—è –∑–∞ –∫–ª—é—á–µ–º
    return modules.find((m) => m.key === key);
  },

  hasPermission: (moduleKey, permission) => {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤
    const module = modules.find((m) => m.key === moduleKey);
    return module ? module.permissions[permission] : false;
  },

  isModuleActive: (moduleKey) => {
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º–æ–¥—É–ª—è
    return modules.some((m) => m.key === moduleKey);
  }
}));
```

**–õ–æ–≥—ñ–∫–∞**:

- –ö–µ—à—É—î –º–æ–¥—É–ª—ñ –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
- –ù–∞–¥–∞—î –º–µ—Ç–æ–¥–∏ –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –º–æ–¥—É–ª—è–º–∏
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑—É—î –≤—Å—é –ª–æ–≥—ñ–∫—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–æ–∑–≤–æ–ª—ñ–≤
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î —Å—Ç–∞–Ω –ø—Ä–∏ –∑–º—ñ–Ω–∞—Ö

### 4. **Route Guard** - `components/auth/module-route-guard.tsx`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ó–∞—Ö–∏—Å—Ç –º–∞—Ä—à—Ä—É—Ç—ñ–≤ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –º–æ–¥—É–ª—å–Ω–∏—Ö –¥–æ–∑–≤–æ–ª—ñ–≤

```typescript
export function ModuleRouteGuard({
  children,
  moduleKey,
  requiredPermission = 'can_view'
}) {
  const { isRouteAccessible, hasPermission } = useModulesStore();

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –º–∞—Ä—à—Ä—É—Ç—É
  if (!isRouteAccessible(pathname)) {
    return <AccessDenied />;
  }

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –º–æ–¥—É–ª—è
  if (!hasPermission(moduleKey, requiredPermission)) {
    return <AccessDenied />;
  }

  return <>{children}</>;
}
```

**–õ–æ–≥—ñ–∫–∞**:

- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ—Å—Ç—É–ø –¥–æ –º–∞—Ä—à—Ä—É—Ç—É –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
- –ë–ª–æ–∫—É—î –¥–æ—Å—Ç—É–ø —è–∫—â–æ –º–æ–¥—É–ª—å –Ω–µ–∞–∫—Ç–∏–≤–Ω–∏–π
- –ü–µ—Ä–µ–≤—ñ—Ä—è—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –¥–æ–∑–≤–æ–ª–∏ (view/edit/delete)
- –ü–æ–∫–∞–∑—É—î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –¥–æ—Å—Ç—É–ø—É

### 5. **Module Renderer** - `components/modules/module-renderer.tsx`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –î–∏–Ω–∞–º—ñ—á–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ –º–æ–¥—É–ª—å–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤

```typescript
const moduleComponents = {
  dashboard: dynamic(() => import('@/modules/dashboard')),
  cars: dynamic(() => import('@/app/(admin)/cars/page')),
  bookings: dynamic(() => import('@/app/(admin)/bookings/page'))
  // ... —ñ–Ω—à—ñ –º–æ–¥—É–ª—ñ
};

export function ModuleRenderer({ moduleKey }) {
  const { isModuleActive, hasPermission } = useModulesStore();

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –º–æ–¥—É–ª—è
  if (!isModuleActive(moduleKey)) {
    return <ModuleNotAvailable />;
  }

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤
  if (!hasPermission(moduleKey, 'can_view')) {
    return <NoPermission />;
  }

  // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  const ModuleComponent = moduleComponents[moduleKey];
  return <ModuleComponent />;
}
```

**–õ–æ–≥—ñ–∫–∞**:

- Lazy loading –º–æ–¥—É–ª—ñ–≤ (–∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ)
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ —Ç–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –ø–µ—Ä–µ–¥ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–æ–º
- Fallback –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —è–∫ –Ω–æ–≤–∏—Ö –º–æ–¥—É–ª—ñ–≤, —Ç–∞–∫ —ñ —ñ—Å–Ω—É—é—á–∏—Ö —Å—Ç–æ—Ä—ñ–Ω–æ–∫

### 6. **–î–∏–Ω–∞–º—ñ—á–Ω–∏–π Sidebar** - `components/app-sidebar.tsx`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–æ–±—É–¥–æ–≤–∞ –º–µ–Ω—é –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∞–∫—Ç–∏–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤

```typescript
export function AppSidebar() {
  const { modules, fetchModules, isLoading } = useModulesStore();

  // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–æ–¥—É–ª—ñ–≤ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
  React.useEffect(() => {
    fetchModules();
  }, [fetchModules]);

  // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –º–æ–¥—É–ª—ñ–≤ –≤ —Ñ–æ—Ä–º–∞—Ç –º–µ–Ω—é
  const navMain = modules
    .filter((module) => module.menu) // –¢—ñ–ª—å–∫–∏ –º–æ–¥—É–ª—ñ –∑ menu: true
    .sort((a, b) => a.order - b.order) // –°–æ—Ä—Ç—É–≤–∞–Ω–Ω—è –ø–æ –ø–æ—Ä—è–¥–∫—É
    .map(convertModuleToNavItem); // –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—è –≤ —Ñ–æ—Ä–º–∞—Ç –º–µ–Ω—é

  return (
    <Sidebar>
      {isLoading ? <LoadingState /> : <NavMain items={navMain} />}
    </Sidebar>
  );
}
```

**–õ–æ–≥—ñ–∫–∞**:

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –º–æ–¥—É–ª—ñ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ
- –§—ñ–ª—å—Ç—Ä—É—î –º–æ–¥—É–ª—ñ —è–∫—ñ –ø–æ–≤–∏–Ω–Ω—ñ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏—Å—è –≤ –º–µ–Ω—é
- –°–æ—Ä—Ç—É—î –ø–æ –ø–æ—Ä—è–¥–∫—É (order)
- –ö–æ–Ω–≤–µ—Ä—Ç—É—î –º–æ–¥—É–ª—ñ –≤ —Ñ–æ—Ä–º–∞—Ç, –∑—Ä–æ–∑—É–º—ñ–ª–∏–π –¥–ª—è NavMain
- –ü–æ–∫–∞–∑—É—î —Å—Ç–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

### 7. **Middleware** - `middleware.ts`

**–ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –î–æ–¥–∞—Ç–∫–æ–≤–∏–π –∑–∞—Ö–∏—Å—Ç –º–∞—Ä—à—Ä—É—Ç—ñ–≤ –Ω–∞ —Ä—ñ–≤–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞

```typescript
const PROTECTED_ROUTES = ['/users', '/documents'];

export async function middleware(request: NextRequest) {
  const pathname = request.nextUrl.pathname;

  // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ –º–∞—Ä—à—Ä—É—Ç –ø–æ—Ç—Ä–µ–±—É—î –∑–∞—Ö–∏—Å—Ç—É
  if (isProtectedRoute(pathname)) {
    const moduleKey = getModuleKeyFromRoute(pathname);

    // –í —Ä–µ–∞–ª—å–Ω–æ–º—É –ø—Ä–æ–µ–∫—Ç—ñ —Ç—É—Ç –±—É–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    // –ù–∞—Ä–∞–∑—ñ –∑–∞–ª–∏—à–∞—î–º–æ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —á–∞—Å—Ç–∏–Ω—ñ
  }

  return NextResponse.next();
}
```

**–õ–æ–≥—ñ–∫–∞**:

- –í–∏–∑–Ω–∞—á–∞—î —è–∫—ñ –º–∞—Ä—à—Ä—É—Ç–∏ –ø–æ—Ç—Ä–µ–±—É—é—Ç—å –∑–∞—Ö–∏—Å—Ç—É
- –ú–∞–ø–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏ –Ω–∞ –º–æ–¥—É–ª—ñ
- –í –º–∞–π–±—É—Ç–Ω—å–æ–º—É –±—É–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –¥–æ–∑–≤–æ–ª–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ
- –ù–∞—Ä–∞–∑—ñ –ø–µ—Ä–µ–¥–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—å –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —á–∞—Å—Ç–∏–Ω—ñ

## üîÑ –ü–æ—Ç—ñ–∫ —Ä–æ–±–æ—Ç–∏ —Å–∏—Å—Ç–µ–º–∏

### 1. **–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è**

```
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∑–∞—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–∞–π—Ç
   ‚Üì
2. AppSidebar –≤–∏–∫–ª–∏–∫–∞—î fetchModules()
   ‚Üì
3. –ó–∞–ø–∏—Ç –¥–æ /api/modules/active
   ‚Üì
4. –û—Ç—Ä–∏–º–∞–Ω–Ω—è —Å–ø–∏—Å–∫—É –∞–∫—Ç–∏–≤–Ω–∏—Ö –º–æ–¥—É–ª—ñ–≤
   ‚Üì
5. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ Zustand store
```

### 2. **–ü–æ–±—É–¥–æ–≤–∞ –º–µ–Ω—é**

```
1. modules.filter(module => module.menu)
   ‚Üì
2. modules.sort((a, b) => a.order - b.order)
   ‚Üì
3. modules.map(convertModuleToNavItem)
   ‚Üì
4. –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ NavMain –∑ –¥–∏–Ω–∞–º—ñ—á–Ω–∏–º–∏ –ø—É–Ω–∫—Ç–∞–º–∏
```

### 3. **–ù–∞–≤—ñ–≥–∞—Ü—ñ—è**

```
1. –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –∫–ª—ñ–∫–∞—î –Ω–∞ –ø—É–Ω–∫—Ç –º–µ–Ω—é
   ‚Üì
2. –ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ –º–∞—Ä—à—Ä—É—Ç (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ /cars)
   ‚Üì
3. Middleware –ø–µ—Ä–µ–≤—ñ—Ä—è—î —á–∏ –º–∞—Ä—à—Ä—É—Ç –∑–∞—Ö–∏—â–µ–Ω–∏–π
   ‚Üì
4. ModuleRouteGuard –ø–µ—Ä–µ–≤—ñ—Ä—è—î –¥–æ–∑–≤–æ–ª–∏ –º–æ–¥—É–ª—è
   ‚Üì
5. ModuleRenderer –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–¥—É–ª—è
```

### 4. **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤**

```
1. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–∏–∫–ª–∏–∫–∞—î useModulePermission('cars')
   ‚Üì
2. Store –ø–µ—Ä–µ–≤—ñ—Ä—è—î hasPermission('cars', 'can_view')
   ‚Üì
3. –ü–æ–≤–µ—Ä—Ç–∞—î true/false –Ω–∞ –æ—Å–Ω–æ–≤—ñ –¥–∞–Ω–∏—Ö –º–æ–¥—É–ª—è
   ‚Üì
4. –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –ø–æ–∫–∞–∑—É—î/–ø—Ä–∏—Ö–æ–≤—É—î UI –µ–ª–µ–º–µ–Ω—Ç–∏
```

## üéØ –ü–µ—Ä–µ–≤–∞–≥–∏ —Å–∏—Å—Ç–µ–º–∏

### **–î–∏–Ω–∞–º—ñ—á–Ω—ñ—Å—Ç—å**

- –ú–æ–¥—É–ª—ñ –º–æ–∂–Ω–∞ –≤–º–∏–∫–∞—Ç–∏/–≤–∏–º–∏–∫–∞—Ç–∏ —á–µ—Ä–µ–∑ API
- –ú–µ–Ω—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é—î—Ç—å—Å—è
- –ù–µ–º–∞—î –ø–æ—Ç—Ä–µ–±–∏ –≤ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É

### **–ë–µ–∑–ø–µ–∫–∞**

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –º–∞—Ä—à—Ä—É—Ç—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –Ω–∞ –≤—Å—ñ—Ö —Ä—ñ–≤–Ω—è—Ö
- –ü—Ä–∏—Ö–æ–≤—É–≤–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏—Ö UI –µ–ª–µ–º–µ–Ω—Ç—ñ–≤

### **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**

- –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –º–æ–¥—É–ª—ñ
- –¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–µ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –¥–æ–∑–≤–æ–ª–∞–º–∏
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —Ä–æ–ª–µ–π –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**

- Lazy loading –º–æ–¥—É–ª—ñ–≤
- –ö–µ—à—É–≤–∞–Ω–Ω—è –Ω–∞ 5 —Ö–≤–∏–ª–∏–Ω
- –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω—ñ –∑–∞–ø–∏—Ç–∏ –¥–æ API

## üõ†Ô∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

### **Backend —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è**

–ó–∞–º—ñ–Ω–∏—Ç–∏ mock –¥–∞–Ω—ñ –≤ `/api/modules/active/route.ts`:

```typescript
// –ó–∞–º—ñ—Å—Ç—å ACTIVE_MODULES
const response = await fetch(`${NESTJS_API_URL}/modules/active`, {
  headers: { Authorization: `Bearer ${token}` }
});
const modules = await response.json();
```

### **–ö–µ—à—É–≤–∞–Ω–Ω—è**

–ó–º—ñ–Ω–∏—Ç–∏ —á–∞—Å –∫–µ—à—É–≤–∞–Ω–Ω—è –≤ `useModulesStore.ts`:

```typescript
// –ó–∞–º—ñ—Å—Ç—å 5 —Ö–≤–∏–ª–∏–Ω
if (lastFetched && now - lastFetched < 30 * 60 * 1000) {
  return; // 30 —Ö–≤–∏–ª–∏–Ω
}
```

### **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**

–î–æ–¥–∞—Ç–∏ –ª–æ–≥—É–≤–∞–Ω–Ω—è –≤ –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö:

```typescript
console.log(`Module ${moduleKey} accessed by user ${userId}`);
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

### **–ú–æ–¥—É–ª—å**

```typescript
{
  key: 'cars',                    // –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä
  name: 'Cars',                  // –ù–∞–∑–≤–∞ –¥–ª—è UI
  routes: ['/cars', '/brands'],   // –ú–∞—Ä—à—Ä—É—Ç–∏ –º–æ–¥—É–ª—è
  icon: 'IconListDetails',        // –Ü–∫–æ–Ω–∫–∞
  menu: true,                     // –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤ –º–µ–Ω—é
  order: 2,                       // –ü–æ—Ä—è–¥–æ–∫ —Å–æ—Ä—Ç—É–≤–∞–Ω–Ω—è
  permissions: {                  // –î–æ–∑–≤–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
    can_view: true,
    can_edit: true,
    can_delete: false
  },
  subItems: [                    // –ü—ñ–¥–ø—É–Ω–∫—Ç–∏ –º–µ–Ω—é
    { title: 'All Cars', url: '/cars' },
    { title: 'Brands', url: '/brands' }
  ]
}
```

### **API Response**

```typescript
{
  status: 200,
  data: Module[],                // –ú–∞—Å–∏–≤ –º–æ–¥—É–ª—ñ–≤
  message: 'Success',
  error?: string                 // –ü–æ–º–∏–ª–∫–∞ (—è–∫—â–æ —î)
}
```

## üîß –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### **–î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –º–æ–¥—É–ª—è**

1. –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å—Ç–æ—Ä—ñ–Ω–∫—É –≤ `app/(admin)/new-module/page.tsx`
2. –î–æ–¥–∞—Ç–∏ –¥–æ API endpoint –≤ `route.ts`
3. –î–æ–¥–∞—Ç–∏ —ñ–∫–æ–Ω–∫—É –≤ `app-sidebar.tsx`
4. –î–æ–¥–∞—Ç–∏ –¥–æ `moduleComponents` –≤ `module-renderer.tsx`

### **–ó–∞—Ö–∏—Å—Ç —Å—Ç–æ—Ä—ñ–Ω–∫–∏**

```typescript
export default function Page() {
  return (
    <ModuleRouteGuard moduleKey='cars'>
      <CarsComponent />
    </ModuleRouteGuard>
  );
}
```

### **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –¥–æ–∑–≤–æ–ª—ñ–≤ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ**

```typescript
function MyComponent() {
  const { canEdit, canDelete } = useModulePermission('cars');

  return (
    <div>
      {canEdit && <EditButton />}
      {canDelete && <DeleteButton />}
    </div>
  );
}
```

## üéâ –í–∏—Å–Ω–æ–≤–æ–∫

–ú–æ–¥—É–ª—å–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –∑–∞–±–µ–∑–ø–µ—á—É—î:

- **–ì–Ω—É—á–∫—ñ—Å—Ç—å**: –ú–æ–¥—É–ª—ñ –∫–µ—Ä—É—é—Ç—å—Å—è —á–µ—Ä–µ–∑ API
- **–ë–µ–∑–ø–µ–∫—É**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –Ω–∞ –≤—Å—ñ—Ö —Ä—ñ–≤–Ω—è—Ö
- **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ –º–æ–¥—É–ª—ñ
- **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**: –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- **–¢–∏–ø–æ–±–µ–∑–ø–µ–∫—É**: –ü–æ–≤–Ω–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–∞ TypeScript

–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞ –ª–µ–≥–∫–æ –∞–¥–∞–ø—Ç—É—î—Ç—å—Å—è –ø—ñ–¥ –ø–æ—Ç—Ä–µ–±–∏ –ø—Ä–æ–µ–∫—Ç—É!
